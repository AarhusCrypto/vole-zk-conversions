<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.0/katex.min.css"
    integrity="sha512-MJmGvrYhgWyFswGuarVFhndqozyLfTRtlbC21mYB+6I1IWvfAuPbEWd38bfQKbrTUb7Jba/bQg/vA9htQu6clQ=="
    crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.0/katex.min.js"
    integrity="sha512-RUPvLPAfrnUiXmfqR6xAYlt238VtSE3pOlqlov7LPnk0EAi3U6SvvSLgxNukvwabGjt0F43s0c/rvIZdlD4+Qg=="
    crossorigin="anonymous"></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        function foreach(dom_array, cb) {
            // Is NodeList even still a thing...?
            for (var i = 0; i < dom_array.length; i++) {
                cb(dom_array[i]);
            }
        }
        foreach(document.querySelectorAll("code.language-math"), function (elem) {
            katex.render(elem.textContent, elem, { display: true });
            elem.style.display = "flex";
            elem.style.justifyContent = "center";
            elem.style.alignItems = "center";
            elem.style.backgroundColor = "transparent";
            if (elem.parentElement.tagName === "PRE")
                elem.parentElement.style.backgroundColor = "transparent";
        });
        foreach(document.querySelectorAll("code"), function (elem) {
            if (elem.className !== '') return;
            function checkSibling(sibling, dollarAtEnd) {
                if (!sibling)
                    return false;
                if (!sibling.nodeType === Node.TEXT_NODE)
                    return false;
                if (!sibling.textContent)
                    return false;
                if (sibling.textContent[dollarAtEnd ? sibling.textContent.length - 1 : 0] != '$')
                    return false;
                return true;
            }
            function removeSiblingDollarSign(sibling, dollarAtEnd) {
                sibling.textContent = sibling.textContent.substr(
                    dollarAtEnd ? 0 : 1,
                    sibling.textContent.length - 1
                );
            }
            if (!checkSibling(elem.previousSibling, true))
                return;
            if (!checkSibling(elem.nextSibling, false))
                return;
            removeSiblingDollarSign(elem.previousSibling, true);
            removeSiblingDollarSign(elem.nextSibling, false);
            katex.render(elem.textContent, elem, { display: false });
            elem.style.backgroundColor = 'transparent';
        });
    });
</script>